ðŸ“œ **Collabryx** **Project** **Contract** **&** **Architectural**
**Blueprint**

Version: 1.0.0

Project: Collabryx (Next.js 16 + Supabase + AI) Branch Strategy: - main
(Production)

> â— develop (Staging)
>
> â— backend/setup (Zain) â— frontend/ui (Ahsan)

**1.** âš”ï¸ **The** **Iron** **Rules** **(Meta-Contracts)**

**The** **Package** **Manager** **Pact**

> â— **Tool:** We use **npm** exclusively.
>
> â— **Lock** **File:** package-lock.json is sacred. If you have a merge
> conflict in this file, delete it and node_modules, then run npm
> install.
>
> â— **No** **New** **Toys:** Do not install new libraries (axios,
> moment, redux, emotion) without a written agreement. Use what is
> installed (fetch, date-fns, zustand, tailwind).

**The** **Env** **Variable** **Treaty**

> â— **Zain's** **Duty:** If you add a secret to .env.local, you **MUST**
> immediately add the key (with an empty value) to .env.example and push
> it.
>
> â— **Ahsan's** **Duty:** Check .env.example after every git pull.

**The** **Shared** **Validation** **Strategy**

> â— **Location:** All validation logic lives in lib/validations/. â—
> **Rule:** Zod schemas are defined **once**.
>
> â—‹ Frontend imports them for react-hook-form.
>
> â—‹ Backend imports them for API route validation.

**2.** ï¸ **Routing** **Map** **(The** **URL** **Contract)** **Usage:** Do
not hardcode strings. Import ROUTES from @/lib/constants.

||
||
||
||

||
||
||
||
||
||
||
||
||
||
||

**3.** ï¸ **Database** **Schema** **(Zain's** **Domain)**

**Note** **to** **Ahsan:** Use these field names exactly in your UI. Do
not use camelCase for DB columns; Supabase uses snake_case.

**Table:** **profiles**

> â— id (uuid, PK): References auth.users.id â— email (text): Read-only
>
> â— full_name (text): Required â— avatar_url (text): Optional â— bio
> (text): Optional
>
> â— role (text): 'mentor' \| 'mentee' â— skills (text\[\]): Array of
> strings â— goals (text\[\]): Array of strings
>
> â— embedding (vector(1536)): Generated by OpenAI (Hidden from UI) â—
> created_at (timestamptz)

**Table:** **conversations**

> â— id (uuid, PK)
>
> â— created_at (timestamptz)
>
> â— participant_ids (uuid\[\]): Array of user IDs in the chat

**Table:** **messages**

> â— id (uuid, PK)
>
> â— conversation_id (uuid, FK): References conversations.id â— sender_id
> (uuid, FK): References profiles.id
>
> â— content (text): The actual message â— created_at (timestamptz)

**4.** ðŸ”Œ **API** **Response** **Shapes** **(The** **Interface**
**Contract)**

**Note** **to** **Zain:** Your APIs must return data in exactly this
format so Ahsan's frontend doesn't break.

**Endpoint:** **GET** **/api/matches**

Used in: hooks/use-matches.ts

{

> "data": \[ {
>
> "id": "uuid-123", "full_name": "John Doe", "role": "mentor",
> "avatar_url": "https://...", "skills": \["React", "Node.js"\],
>
> "similarity": 0.89 // Calculated by vector search }
>
> \],

"error": null }

**Endpoint:** **POST** **/api/chat** **(AI** **Assistant)**

Used in: hooks/use-chat.ts

> â— **Format:** Streaming Text Response (Standard Vercel AI SDK format).
> â— **Input** **Body:** { "messages": \[{ "role": "user", "content":
> "..." }\] }

**5.** âœ… **Division** **of** **Responsibility** **Checklist** ðŸŸ¢
**Zain** **(Backend** **&** **Data)**

> â— \[ \] **DB** **Init:** Create profiles table with RLS policies
> (Users can only edit their own profile). â— \[ \] **Vector** **Setup:**
> Enable pgvector extension in Supabase.
>
> â— \[ \] **Type** **Gen:** Run supabase gen types and push
> types/database.types.ts.
>
> â— \[ \] **Edge** **Function:** Create generate-embedding function
> (Triggered on Profile Update). â— \[ \] **Edge** **Function:** Create
> get-matches RPC function (Cosine similarity search).
>
> â— \[ \] **API:** Implement route.ts for Auth Callback.

ðŸ”µ **Ahsan** **(Frontend** **&** **AI** **UI)**

> â— \[ \] **Components:** Build MessageBubble, ChatInput, MatchCard.
>
> â— \[ \] **Forms:** Build Login/Register forms using react-hook-form +
> zod.
>
> â— \[ \] **Hooks:** Create useMatches (Use dummy data \[\] until Zain
> finishes). â— \[ \] **AI** **Page:** Build /assistant using useChat
> from ai/react.
>
> â— \[ \] **Onboarding:** Build multi-step wizard saving to profiles
> table.

**6.** ðŸš¨ **Emergency** **Protocols**

"The API Isn't Ready Yet" Protocol:

If Ahsan needs to build the UI but Zain hasn't finished the API: 1.
Ahsan **MUST** create a mock data file in lib/mock-data.ts. 2. Ahsan
builds the UI using the mock data.

> 3\. When Zain finishes, Ahsan swaps the mock import for the fetch
> call.

**"The** **Types** **Are** **Broken"** **Protocol:**

> 1\. Zain runs the generator locally. 2. Zain commits the file.
>
> 3\. Ahsan pulls the branch.
>
> 4\. **NEVER** manually edit types/database.types.ts.
